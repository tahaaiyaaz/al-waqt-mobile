<!DOCTYPE html>
<html>

<head>
    <title>POST Request</title>
</head>

<body>
    <button id="postRequestBtn">Send POST Request and get request</button>
    <script>

        
        document.getElementById("postRequestBtn").addEventListener("click", async () => {
           
           
           
           
           
           
// Example usage:
updateUserDetails("104262940198730281069", {
    name: "taha bro",
    email:"taha@gmail.com",
    favorites:['5cWzpDG95UwJtb6aPYt3']

});
           
           
           
           
           
           
           
           
           
           
           
            // signupWithMobile()
          
          
        //   uid = ""
          
          
// getFavoriteMasjids("104262940198730281069");

          
          
          
          
          
          
          
          
          
          
            // let details = {
            //                 name:"abc",
            //                 address:"def",
            //                 capacity:1000,
            //                 latitude:12.9716,
            //                 longitude:77.5946,
            //                 jummatiming:"01:30",
            //                 masjidtype:"islamic",
            //                 masjidstatus:"active",
            //                 timings : {                    
            //                     asar:"05:30pm",
            //                     dhuhr:"12:00 PM",
            //                     fajr:"4:30 AM",
            //                     isha:"09:00 PM",
            //                     juma:"01:30pm",
            //                     maghrib:"07:30 PM",
            //                 }

            //         }
            // updateMasjidDetails("5cWzpDG95UwJtb6aPYt3",details)
                   
            // masjidData = {

            //     latitude: 1.219387321,
            //                 longitude:1.219387321,
            //                 countryName: "india",
            //                 cityName: "8v47A9GCsYnHTqI89fgo",
            //                 stateName: "ittHHaY4WZLto16Hu58G",
            //                 details: details

            // }

            // getNearestMasjid(16.7493422, 78.0107288, 5000);

            //fetchCities("0rxDjuXEOh13cNG7O58n")
            //    let details ={
            //         name:"bcd",
            //         timings:{
            //             fajr:"01:30"
            //         }
            //     }

            //         addMasjid(masjidData)

            // signUpUser("emai@gmail.com", "password", "name", "3290230923")

            // fetchStates()
            // fetchCities("0rxDjuXEOh13cNG7O58n")




            // addallstatesanddistricts()


            //     loginUser('exampl@example.com', 'password123')
            // .then(response => {
            //     console.log('Signup successful:', response);
            // })
            // .catch(error => {
            //     console.error('Signup failed:', error.message);
            // });
            // searchMasjidByName("Ma")
            // searchMasjidByName()
            // updateMasjidDetails()
            //   const result = await getNearestMasjid(12.9716, 77.5946, 5000);


            // try {
            //     const newMasjid = {
            //         latitude: 12.9716,
            //         longitude: 77.5946,
            //         countryName: "India",
            //         cityName: "Bangalore",
            //         stateName: "Karnataka",
            //         details: "Example Masjid with additional information"
            //     };

            //     const result = await addMasjid(newMasjid);
            //     console.log('Success:', result);
            // } catch (error) {
            //     console.error('Error:', error);
            // }
            // console.log('Nearby masjids:', result);

            // getNearestMasjid(12.9716,77.5946, 5000);


            //   try {
            //     const response = await fetch("http://127.0.0.1:5001/functionsinjs/asia-south1/masjidapp01/addmasjid", {
            //       method: "POST",
            //       headers: {
            //         "Content-Type": "application/json",
            //       },
            //       body: JSON.stringify({
            //         latitude: 12.9716,
            //         longitude: 77.5946,
            //         countryName: "India",
            //         stateName: "Karnataka",
            //         cityName: "Bangalore",
            //         details: {
            //             name:"abc",
            //             address:"def",
            //             capacity:1000,
            //             latitude:12.9716,
            //             longitude:77.5946,
            //             jummatiming:"01:30",
            //             masjidtype:"islamic",
            //             masjidstatus:"active",
            //             masjidimage:"https://example.com/image.jpg",

            //         },
            //       }),
            //     });

            //     const data = await response.json();
            //     console.log(data);
            //     alert("Response: " + JSON.stringify(data));
            //   } catch (error) {
            //     console.error("Error:", error);
            //     alert("Error: " + error.message);
            //   }
        });



        //     async function getNearestMasjid(latitude, longitude, radius) {
        //   const url = new URL('https://us-central1-functionsinjs.cloudfunctions.net/handleseduledtasks/getNearestMasjid');
        //   url.searchParams.append('latitude', latitude);
        //   url.searchParams.append('longitude', longitude);
        //   url.searchParams.append('radiusInKm', radius);

        //   try {
        //     const response = await fetch(url, {
        //       method: 'GET',
        //     });
        //     if (!response.ok) {
        //       throw new Error(`Error: ${response.status}`);
        //     }
        //     const data = await response.json();
        //     console.log('Nearest Masjids:', data.masjids);
        //   } catch (error) {
        //     console.error('Error fetching nearest masjids:', error.message);
        //   }




        // // fetch('http://127.0.0.1:5001/functionsinjs/asia-south1/getMasjidsAround/getNearestMasjid', {
        // //     method: 'POST',
        // //     headers: { 'Content-Type': 'application/json' },
        // //     body: JSON.stringify({
        // //         latitude: 12.9716,
        // //         longitude: 77.5946,
        // //         radiusInKm: 5,
        // //     }),
        // // }).then((res)=>{

        // //     console.log(res.data())
        // // })


        // }





        // async function getNearestMasjid(latitude, longitude, radiusInKm = 5) {
        //   const baseUrl = 'https://us-central1-functionsinjs.cloudfunctions.net/handleseduledtasks';
        //   const url = `${baseUrl}/getNearestMasjid?latitude=${latitude}&longitude=${longitude}&radiusInKm=${radiusInKm}`;


        //   const response = await fetch('https://us-central1-functionsinjs.cloudfunctions.net/handleseduledtasks/getNearestMasjid?latitude=12.9716&longitude=77.5946&radiusInKm=5000');
        // const data = await response.json();
        // console.log(data);


        //   // try {
        //   //   const response = await fetch(url, {
        //   //     method: 'GET',
        //   //     headers: {
        //   //       'Content-Type': 'application/json'
        //   //     }
        //   //   });

        //   //   const data = await response.json();
        //   //   return data;
        //   // } catch (error) {
        //   //   console.error('Error fetching nearest masjid:', error);
        //   //   throw error;
        //   // }
        // }


        // Example Usage:


        async function addMasjid(masjidData) {
            const url = 'https://helloworld-ftfo4ql2pa-uc.a.run.app/addmasjid';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Add any other headers if needed
                    },
                    body: JSON.stringify({
                        latitude: masjidData.latitude,
                        longitude: masjidData.longitude,
                        countryName: masjidData.countryName,
                        cityName: masjidData.cityName,
                        stateName: masjidData.stateName,
                        details: masjidData.details
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Masjid added successfully:', result);
                return result;
            } catch (error) {
                console.error('Error adding masjid:', error);
                throw error;
            }
        }



        async function updateMasjidDetails(masjidId, updates) {
            try {



                // apiUrl = "http://127.0.0.1:5001/functionsinjs/asia-south1/helloWorld"
                let apiUrl = "https://helloworld-ftfo4ql2pa-uc.a.run.app"

                masjidId = masjidId
                // Construct the request body
                const requestBody = {
                    masjidId: masjidId,
                    updates: updates
                };

                // Make the fetch request
                const response = await fetch(`${apiUrl}/updateMasjid`, {
                    method: "PUT", // HTTP method
                    headers: {
                        "Content-Type": "application/json", // Specify JSON content type
                    },
                    body: JSON.stringify(requestBody) // Convert the body to JSON string
                });

                // Parse the response
                const data = await response.json();

                if (response.ok) {
                    console.log("Masjid updated successfully:", data);
                } else {
                    console.error("Error updating masjid:", data.message);
                }
            } catch (error) {
                console.error("Error during fetch:", error);
            }
        }




        async function getNearestMasjid(latitude, longitude, radiusInKm = 5000) {
            // const baseUrl = 'http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld';
            const baseUrl = 'https://helloworld-ftfo4ql2pa-uc.a.run.app';

            const url = `${baseUrl}/getNearestMasjid?latitude=${latitude}&longitude=${longitude}&radiusInKm=${radiusInKm}`;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'cors', // explicitly set CORS mode
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log(data)
                return data;
            } catch (error) {
                console.error('Error:', error);
                throw error;
            }
        }



        async function searchMasjidByName(masjidName) {
            // const url = `http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/searchMasjidByName?name=${encodeURIComponent(masjidName)}`;
            const url = `https://helloworld-ftfo4ql2pa-uc.a.run.app/searchMasjidByName?name=${encodeURIComponent(masjidName)}`;


            try {
                const response = await fetch(url, {
                    method: 'GET', // You can also use 'POST' if needed
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                console.log("Search results:", data.masjids);
                return data.masjids; // This returns the list of masjids
            } catch (error) {
                console.error("Error calling Firebase function:", error);
            }
        }






        async function loginUser(email, password) {
            try {
                // const response = await fetch('http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/login', {
                const response = await fetch('https://helloworld-ftfo4ql2pa-uc.a.run.app/login', {

                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Login failed');
                }

                const userDetails = await response.json();
                console.log('User details:', userDetails);
                return userDetails; // You can handle the returned user details as needed
            } catch (error) {
                console.error('Error during login:', error.message);
                alert(error.message); // Show an alert or handle error UI
            }
        }



        async function signUpUser(email, password, name, mobileNumber) {
            try {
                // const response = await fetch('http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/signup', {
                const response = await fetch('http://127.0.0.1:5001/functionsinjs/asia-south1/helloWorld/signup', {

                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        orderId: {
                            name: name,
                            mobileNumber: mobileNumber,
                        },
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Signup failed');
                }

                const userid = await response.json();
                console.log('Signup successful:', userid);
                return userid; // You can handle the userid response as needed
            } catch (error) {
                console.error('Error during signup:', error.message);
                alert(error.message); // Show an alert or handle error UI
            }
        }


        // async function addallstatesanddistricts() {
        //     try {
        //         const response = await fetch('http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/getStates', {
        //             method: 'POST',
        //             headers: {
        //                 'Content-Type': 'application/json',
        //             }
        //         });

        //         if (!response.ok) {
        //             const errorData = await response.json();
        //             throw new Error(errorData.message || 'Signup failed');
        //         }

        //         const userid = await response.json();
        //         console.log('Signup successful:', userid);
        //         return userid; // You can handle the userid response as needed
        //     } catch (error) {
        //         console.error('Error during signup:', error.message);
        //         alert(error.message); // Show an alert or handle error UI
        //     }
        // }


        async function fetchStates() {
            // const response = await fetch("http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/getStates");
            const response = await fetch("https://helloworld-ftfo4ql2pa-uc.a.run.app/getStates");

            const data = await response.json();
            console.log(data)
            return data.states; // Array of states
        }

        async function fetchCities(stateID) {
            // const response = await fetch(`http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/getCities?stateID=${stateID}`);
            const response = await fetch(`https://helloworld-ftfo4ql2pa-uc.a.run.app/getCities?stateID=${stateID}`);

            const data = await response.json();
            console.log(data.cities)
            return data.cities; // Array of cities
        }


        async function fetchMasjids(cityID) {
            // const response = await fetch(`http://127.0.0.1:5001/functionsinjs/us-central1/helloWorld/getMasjids?cityID=${cityID}`);
            const response = await fetch(`https://helloworld-ftfo4ql2pa-uc.a.run.app/getMasjids?cityID=${cityID}`);

            const data = await response.json();
            return data.masjids; // Array of masjids
        }





        async function getFavoriteMasjids(userId) {
  const apiUrl = 'http://127.0.0.1:5001/functionsinjs/asia-south1/helloWorld/getFavoriteMasjids'; // Update with your URL
  try {
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ userId })
    });

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const data = await response.json();
    console.log('Favorite Masjids:', data.masjids);
    return data.masjids;
  } catch (error) {
    console.error('Error fetching favorite masjids:', error);
  }
}





async function signupWithMobile() {
  const apiUrl = "http://127.0.0.1:5001/functionsinjs/asia-south1/helloWorld/signupWithMobile"; // Replace with your deployed URL
  try {
    const response = await fetch(apiUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        orderId: {
          uid: "6ejSExTFnmSxqYLwGwAI8acsFG32",
          name: "John Doe",
          mobileNumber: "1234567890",
          email:"abc@gmail.com"
        }
      })
    });
    const data = await response.json();
    console.log("Signup response:", data);
  } catch (error) {
    console.error("Error during signup:", error);
  }
}
















async function updateUserDetails(userId, updates) {
    const apiUrl = 'http://127.0.0.1:5001/functionsinjs/asia-south1/helloWorld/updateUser'; // Replace with your deployed URL
    try {
        const response = await fetch(apiUrl, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ userId, updates })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log("Update Response:", data);
        return data;
    } catch (error) {
        console.error("Error updating user details:", error);
    }
}









// Example usage:
    </script>
</body>

</html>
